(()=>{"use strict";var e,r={7410:(e,r,t)=>{t(3848);var n=t(9423),i=t.n(n),o=t(3463),c=t.n(o),a=document.querySelector("#sighting-records"),s=document.querySelector("#grid-distribution"),d=document.querySelector("#species-filter"),l=c().map("map",{center:[23.7,120.9],zoom:7.5,attributionControl:!0,zoomControl:!0}),p=c().layerGroup(),u=c().geoJSON(),g=c().icon({iconUrl:"https://cdn4.iconfinder.com/data/icons/web-ui-color/128/Marker-512.png",iconSize:[25,25]}),f="sightingRecords",h="gridDistribution",y={sightingRecords:[],gridDistribution:[],selectedSpecies:"請選擇類群"===d.innerText?"all":d.innerText},v={displayMap:function(){var e=c().tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community <br> Copyright © 2021 鯨視 All rights reserved. 資訊來源：台灣生物多樣性網絡"});l.addLayer(e)},displayMarker:function(e){p.clearLayers(),l.removeLayer(u);for(var r=0;r<e.length;r++)c().marker([e[r].緯度,e[r].經度],{icon:g}).bindPopup("\n          <h3>".concat(e[r].物種中文名,'</h3>\n          <div>學名：<span class="fst-italic">').concat(e[r].物種學名,"</span></div>\n          <div>觀測日期：").concat(e[r].觀測日期||"無觀測日期","</div>\n          <div>觀測方式：").concat(e[r].觀測方式,"</div>\n          <div>敏感資料座標精確度：").concat(e[r].敏感資料座標精確度,'</div>\n          <div><a href="/data/sighting-records/').concat(e[r].tbnId,'" target="_blank">詳細觀測紀錄</a></div>\n          ')).addTo(p);l.addLayer(p),console.log(b.currentMapType)},displayGrid:function(e){p.clearLayers(),l.removeLayer(u),u=c().geoJSON(e,{style:this.gridStyle,onEachFeature:function(e,r){e.properties&&e.properties[y.selectedSpecies]&&r.bindTooltip('\n            <span class="fs-5">觀測紀錄：'.concat(e.properties[y.selectedSpecies],"筆</span>\n          "))}}).addTo(l),console.log(b.currentMapType)},gridStyle:function(e){return 0===e.properties[y.selectedSpecies]?{weight:0,fillOpacity:0}:e.properties[y.selectedSpecies]<2?{weight:0,fillColor:"#ff0000",fillOpacity:.2}:e.properties[y.selectedSpecies]<5?{weight:0,fillColor:"#ff0000",fillOpacity:.4}:e.properties[y.selectedSpecies]<10?{weight:0,fillColor:"#ff0000",fillOpacity:.5}:{weight:0,fillColor:"#ff0000",fillOpacity:.6}},panTo:function(e){l.panTo([e.緯度,e.經度]),c().marker([e.緯度,e.經度],{icon:g}).addTo(p).bindPopup("\n          <h3>".concat(e.物種中文名,'</h3>\n          <div>學名：<span class="fst-italic">').concat(e.物種學名,"</span></div>\n          <div>觀測日期：").concat(e.觀測日期||"無觀測日期","</div>\n          <div>觀測方式：").concat(e.觀測方式,"</div>\n          <div>敏感資料座標精確度：").concat(e.敏感資料座標精確度,'</div>\n          <div><a href="/data/sighting-records/').concat(e.tbnId,'" target="_blank">詳細觀測紀錄</a></div>\n          ')).openPopup()}},b={currentMapType:localStorage.getItem("currentMapType")||f,getRecords:function(){return i().get("/Taiwan_Cetacean_occurrence.json")},getGrids:function(){return i().get("/tbn_cetacean_count.geojson")},renderMap:function(){var e=this;this.getRecords().then((function(r){return console.log(r.data),"all"===y.selectedSpecies?y.sightingRecords=r.data:y.sightingRecords=r.data.filter((function(e){return e.物種中文名===y.selectedSpecies})),e.getGrids()})).then((function(e){y.gridDistribution=e.data.features,console.log(y)})).then((function(){v.displayMap(),localStorage.setItem("currentMapType",e.currentMapType),e.currentMapType===f?(a.checked="on",v.displayMarker(y.sightingRecords)):(s.checked="on",v.displayGrid(y.gridDistribution)),console.log(e.currentMapType)})).catch((function(e){console.log(e)}))},updateMap:function(){a.checked&&(b.currentMapType=f,v.displayMarker(y.sightingRecords)),s.checked&&(b.currentMapType=h,v.displayGrid(y.gridDistribution)),localStorage.setItem("currentMapType",b.currentMapType)},getRecord:function(e){var r=e.dataset.id,t=y.sightingRecords.find((function(e){return e.OccurrenceUUID===r}));if(!t.緯度||!t.經度)return v.displayMarker(y.sightingRecords);v.panTo(t)}};b.renderMap(),a.addEventListener("change",b.updateMap),s.addEventListener("change",b.updateMap),document.querySelectorAll(".sighting-record").forEach((function(e){e.addEventListener("click",(function(r){b.currentMapType!==h&&b.getRecord(e)}))})),console.log("hot reload success")}},t={};function n(e){var i=t[e];if(void 0!==i)return i.exports;var o=t[e]={exports:{}};return r[e].call(o.exports,o,o.exports,n),o.exports}n.m=r,e=[],n.O=(r,t,i,o)=>{if(!t){var c=1/0;for(d=0;d<e.length;d++){for(var[t,i,o]=e[d],a=!0,s=0;s<t.length;s++)(!1&o||c>=o)&&Object.keys(n.O).every((e=>n.O[e](t[s])))?t.splice(s--,1):(a=!1,o<c&&(c=o));a&&(e.splice(d--,1),r=i())}return r}o=o||0;for(var d=e.length;d>0&&e[d-1][2]>o;d--)e[d]=e[d-1];e[d]=[t,i,o]},n.n=e=>{var r=e&&e.__esModule?()=>e.default:()=>e;return n.d(r,{a:r}),r},n.d=(e,r)=>{for(var t in r)n.o(r,t)&&!n.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:r[t]})},n.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),n.j=826,(()=>{var e={826:0,179:0};n.O.j=r=>0===e[r];var r=(r,t)=>{var i,o,[c,a,s]=t,d=0;for(i in a)n.o(a,i)&&(n.m[i]=a[i]);if(s)var l=s(n);for(r&&r(t);d<c.length;d++)o=c[d],n.o(e,o)&&e[o]&&e[o][0](),e[c[d]]=0;return n.O(l)},t=self.webpackChunk=self.webpackChunk||[];t.forEach(r.bind(null,0)),t.push=r.bind(null,t.push.bind(t))})();var i=n.O(void 0,[216,179],(()=>n(7410)));i=n.O(i)})();